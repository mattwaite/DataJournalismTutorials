---
title: "Data Journalism Lesson 13: Visualizing part 1: magnitude"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
description: >
  Making quick graphics for reporting.
---
```{r setup, include=FALSE}
library(learnr)
library(gradethis)
library(tidyverse)
library(lubridate)
library(glue)
knitr::opts_chunk$set(echo = FALSE)
tutorial_options(exercise.completion=FALSE)
```

# Visualizing your data for reporting

Visualizing data is becoming a much greater part of journalism. Large news organizations are creating graphics desks that create complex visuals with data to inform the public about important events. 

To do it well is a course on it's own. And not every story needs a feat of programming and art. Sometimes, you can help yourself and your story by just creating a quick chart. 

Good news: one of the best libraries for visualizing data is in the tidyverse and it's pretty simple to make simple charts quickly with just a little bit of code.

Let's revisit some data we've used in the past and turn it into charts.

```{r load-tidyverse, exercise=TRUE}
library(tidyverse)
library(lubridate)
```
```{r load-tidyverse-solution}
library(tidyverse)
library(lubridate)
```
```{r load-tidyverse-check}
grade_this_code()
```

Let's work on some examples using the UNLPD reports data. You can download the data here if you want to use it in your own notebook -- and this is the same data we've used before, so if you already downloaded it, you don't need to do it again. **For purposes of this exercise, you don't need to do this. The data is included here if you want to try this in your own notebook.**

```{r echo=FALSE, class.output="bg-info", results="asis",  message=FALSE,  warning=FALSE}
library(downloadthis)
library(glue)

dllink <- download_link(
  link = "https://mattwaite.github.io/datajournalismfiles/crimelogs.csv",
  button_label = "Download csv file",
  button_type = "danger",
  has_icon = TRUE,
  icon = "fa fa-save",
  self_contained = FALSE
)

glue("<pre><p><strong>For this walkthrough:</strong></p><p>{dllink}</p></pre>")

```

Now import the data.

```{r chart-load-data, message=FALSE, warning=FALSE}
crimes <- read_csv("http://mattwaite.github.io/datajournalismfiles/crimelogs.csv")

top10 <- crimes |> 
  group_by(incident_code) |>
  summarize(
    count = n()
  ) |>
  ungroup() |>
  top_n(10, wt=count)

beernweed <- crimes |> 
  filter(
    grepl("ALCOHOL - MINOR IN POSSESSION", incident_code) == TRUE |
    grepl("ALCOHOL - DRUNK", incident_code) == TRUE |
    grepl("NARCOTICS - POSSESSION", incident_code) == TRUE
    ) |>
  mutate(month = floor_date(mdy_hm(reported), unit="months")) |>
  group_by(month, incident_code) |>
  summarize(
    count = n()
  )
```
```{r chart-load-data-exercise, exercise = TRUE}
crimes <- read_csv("http://mattwaite.github.io/datajournalismfiles/crimelogs.csv")
```
```{r chart-load-data-exercise-solution}
crimes <- read_csv("http://mattwaite.github.io/datajournalismfiles/crimelogs.csv")
```
```{r chart-load-data-exercise-check}
grade_this_code()
```

## Bar charts

The first kind of chart we'll create is a simple bar chart. It's a chart designed to show differences between things -- the magnitude of one compared to the next and the next and the next. So if we have thing, like a county, or a state, or a group name, and then a count of that group, we can make a bar chart.

So what does the chart of the top 10 crimes on campus since 2018 look like? 

First, we'll create a dataframe of those top 10, called top10.

### Excercise 1: Making data

```{r top10, exercise=TRUE, exercise.setup = "chart-load-data"}
____ <- ____ |> 
  group_by(incident_code) |>
  summarize(
    count = n()
  ) |>
  ungroup() |>
  top_n(____, wt=count)
```
```{r top10-solution, exercise.reveal_solution = FALSE}
top10 <- crimes |> 
  group_by(incident_code) |>
  summarize(
    count = n()
  ) |>
  ungroup() |>
  top_n(10, wt=count)
```
```{r top10-check}
grade_this_code()
```

Now ggplot. The first thing we do with ggplot is invoke it, which creates the canvas. In ggplot, we work with geometries -- the shape that the data will take -- and aesthetics -- the data that will give it that shape. In a bar chart, we first pass in the data to the geometry, then set the aesthetic. We tell ggplot what the x value is -- in a bar chart, that's almost always your grouping variable from the data you created. Then we tell it the weight of the bar -- the number that will set the height. 

### Exercise 2: Your first bar

```{r bar1, exercise=TRUE, exercise.setup = "chart-load-data"}
ggplot() + 
  geom_bar(data=top10, aes(x=_________, weight=____))
```
```{r bar1-solution, exercise.reveal_solution = FALSE}
ggplot() + 
  geom_bar(data=top10, aes(x=incident_code, weight=count))
```
```{r bar1-check}
grade_this_code()
```

The bars look good, but he order makes no sense. And, can you read the x axis labels? I can't. 

We'll start with the bars. In ggplot, we use reorder, and we reorder the x value based on the weight.

### Exercise 3: Reordering

```{r bar2, exercise=TRUE, exercise.setup = "chart-load-data"}
ggplot() + 
  geom_bar(data=top10, aes(x=reorder(_________, ____), weight=____))
```
```{r bar2-solution, exercise.reveal_solution = FALSE}
ggplot() + 
  geom_bar(data=top10, aes(x=reorder(incident_code, count), weight=count))
```
```{r bar2-check}
grade_this_code()
```

Better, but it still looks ... not great on the bottom. We can fix that by flipping the coordinates. 

### Exercise 3: Flipping

```{r bar3, exercise=TRUE, exercise.setup = "chart-load-data"}
ggplot() + 
  geom_bar(data=top10, aes(x=reorder(_________, ____), weight=____)) + 
  coord_flip()
```
```{r bar3-solution, exercise.reveal_solution = FALSE}
ggplot() + 
  geom_bar(data=top10, aes(x=reorder(incident_code, count), weight=count)) + 
  coord_flip()
```
```{r bar3-check}
grade_this_code()
```

Art? No. Tells you the story? Yep. And for reporting purposes, that's enough. 

## Line charts

Line charts show change over time. It works the much the same as a bar chart, code wise, but instead of a weight, it uses a y. And if you have more than one group in your data, it takes a group element.

The first secret to knowing if you have a line chart is if you have data that changes over time. The second secret to making a line chart is your x value is almost always a date. 

Let's make a new dataframe called beernweed. It's going to be a dataframe of two alcohol and one drug related incident codes that are in the top 10 of reported incidents. We're then going to make a month column which is a floor date of the reported column. Then, we'll count up how many of those incidents happened in each month.  

```{r line1, exercise=TRUE, exercise.setup = "chart-load-data"}
beernweed <- crimes |> 
  filter(
    grepl("ALCOHOL - MINOR IN POSSESSION", incident_code) == TRUE |
    grepl("ALCOHOL - DRUNK", incident_code) == TRUE |
    grepl("NARCOTICS - POSSESSION", incident_code) == TRUE
    ) |>
  mutate(month = floor_date(mdy_hm(reported), unit="months")) |>
  group_by(month, incident_code) |>
  summarize(
    count = n()
  )
```
```{r line1-solution, exercise.reveal_solution = FALSE}
beernweed <- crimes |> 
  filter(
    grepl("ALCOHOL - MINOR IN POSSESSION", incident_code) == TRUE |
    grepl("ALCOHOL - DRUNK", incident_code) == TRUE |
    grepl("NARCOTICS - POSSESSION", incident_code) == TRUE
    ) |>
  mutate(month = floor_date(mdy_hm(reported), unit="months")) |>
  group_by(month, incident_code) |>
  summarize(
    count = n()
  )
```
```{r line1-check}
grade_this_code()
```

Now we'll make a line chart out of this data. From our beernweed dataframe, you have three columns to work with: `month`, `incident_code` and `count`. From those three, we need to fill in the x, the y, the group and the color. The color will help us see which is which. 

### Exercise 5: Making lines

```{r line2, exercise=TRUE, exercise.setup = "chart-load-data"}
ggplot() + 
  geom_line(
    data=____, 
    aes(
      x=____, 
      y=____, 
      group=_________, 
      color=_________
      )
    )
```
```{r line2-solution, exercise.reveal_solution = FALSE}
ggplot() + 
  geom_line(
    data=beernweed, 
    aes(
      x=month, 
      y=count, 
      group=incident_code, 
      color=incident_code
      )
    )
```
```{r line2-check}
grade_this_code()
```

And what do we learn from this? Looks like campus was a much wilder place before the pandemic. COVID tamped down on police calls for alcohol and drugs. But, it looks like alcohol calls are trending back up again.
